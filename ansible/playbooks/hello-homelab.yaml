---
- name: "ğŸ  Hello Homelab - System Connection Test"
  hosts: all
  gather_facts: yes
  
  tasks:
    - name: "ğŸ“ Ping Test (Connectivity Check)"
      ping:
      
    - name: "ğŸ‘‹ Hostname & Basic Info"
      debug:
        msg: |
          ğŸ¯ === {{ inventory_hostname }} ===
          ğŸ  Hostname: {{ ansible_hostname }}
          ğŸ“ Pi Model: {{ ansible_lsb.description | default('Raspberry Pi') }}
          ğŸ’¾ RAM: {{ (ansible_memtotal_mb/1024)|round(1) }}GB
          ğŸ“¡ IP: {{ ansible_default_ipv4.address }}
          ğŸ­ Role: {{ node_role | default('worker') }}
          
    - name: "ğŸŒ¡ï¸ Pi-Temperatur prÃ¼fen (Read-Only)"
      shell: "vcgencmd measure_temp"
      register: temp
      become: yes
      changed_when: false
      
    - name: "ğŸ“Š System-Load prÃ¼fen (Read-Only)"
      shell: "uptime"
      register: uptime_info
      changed_when: false
      
    - name: "ğŸ“ˆ System-Status anzeigen"
      debug:
        msg: |
          ğŸ–¥ï¸ {{ inventory_hostname }} Status:
          ğŸŒ¡ï¸ Temperatur: {{ temp.stdout }}
          ğŸ“ˆ Load Average: {{ ansible_loadavg['1m'] | round(2) }}
          â° Uptime: {{ (ansible_uptime_seconds / 3600) | round(1) }}h ({{ (ansible_uptime_seconds / 86400) | round(1) }} Tage)
          ğŸ’¾ RAM Usage: {{ ((ansible_memtotal_mb - ansible_memfree_mb) / ansible_memtotal_mb * 100) | round(1) }}%
          ğŸ‘¤ SSH User: {{ ansible_user }}
          âœ… System ist bereit!
          
    - name: "ğŸ‰ Cluster-Overview"
      debug:
        msg: |
          ğŸ¢ === RASPBERRY PI CLUSTER STATUS ===
          
          ğŸ–¥ï¸ Hardware-Overview:
          ğŸ–ï¸ Master Node (p1):     {{ hostvars['p1']['ansible_default_ipv4']['address'] }} - {{ (hostvars['p1']['ansible_memtotal_mb']/1024)|round(1) }}GB RAM
          ğŸ‘· Worker Node (p2):     {{ hostvars['p2']['ansible_default_ipv4']['address'] }} - {{ (hostvars['p2']['ansible_memtotal_mb']/1024)|round(1) }}GB RAM
          ğŸ’¾ Data Worker (p3):     {{ hostvars['p3']['ansible_default_ipv4']['address'] }} - {{ (hostvars['p3']['ansible_memtotal_mb']/1024)|round(1) }}GB RAM
          
          ğŸ”¥ Total RAM: {{ ((hostvars['p1']['ansible_memtotal_mb'] + hostvars['p2']['ansible_memtotal_mb'] + hostvars['p3']['ansible_memtotal_mb'])/1024)|round(1) }}GB
          
          âœ… Alle Nodes sind erreichbar und bereit!
      run_once: true
      delegate_to: localhost

      #ansible-playbook playbooks/hello-homelab.yaml